<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>G-Power Web Tool (ANOVA & T-Test)</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; max-width: 700px; margin: 40px auto; padding: 0 20px; background-color: #f9f9f9; color: #333; }
        .container { background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        h1, h2 { text-align: center; color: #2c3e50; }
        .control-group { margin-bottom: 25px; }
        label { font-weight: bold; display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        input[type="range"], input[type="number"] { width: 100%; cursor: pointer; }
        input[type="number"] { padding: 5px; border-radius: 4px; border: 1px solid #ccc; }
        .value-display { font-weight: normal; color: #2980b9; transition: color 0.3s; }
        .value-display.warning { color: #f39c12; font-weight: bold; }
        .tooltip { position: relative; display: inline-block; cursor: pointer; border-bottom: 1px dotted black; }
        .tooltip .tooltiptext { visibility: hidden; width: 240px; background-color: #555; color: #fff; text-align: center; border-radius: 6px; padding: 8px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -120px; opacity: 0; transition: opacity 0.3s; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .presets button { background-color: #ecf0f1; border: 1px solid #bdc3c7; padding: 5px 10px; margin-right: 5px; border-radius: 4px; cursor: pointer; }
        .presets button:hover { background-color: #e0e6e8; }
        #result { background-color: #2980b9; color: white; padding: 15px; border-radius: 5px; text-align: center; font-size: 1.5em; transition: background-color 0.3s; }
        #result.error { background-color: #e74c3c; }
        #loader { text-align: center; color: #7f8c8d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®Ï‚ ÎœÎµÎ³Î­Î¸Î¿Ï…Ï‚ Î”ÎµÎ¯Î³Î¼Î±Ï„Î¿Ï‚</h1>
        <div id="loader"><p>Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ®Ï‚ Î¼Î·Ï‡Î±Î½Î®Ï‚...</p></div>

        <div id="app" style="display:none;">
            <div class="control-group">
                <label for="groups">
                    <span class="tooltip">Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ ÎŸÎ¼Î¬Î´Ï‰Î½ ğŸ‘¨â€âš•ï¸â€âš•ï¸â€âš•ï¸
                        <span class="tooltiptext">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ 2 Î³Î¹Î± T-test. Î•Ï€Î¹Î»Î­Î¾Ï„Îµ 3 Î® Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î³Î¹Î± ANOVA.</span>
                    </span>
                </label>
                <input type="number" id="groups" value="2" min="2" max="10" oninput="updateValues()">
            </div>
            <div class="control-group">
                <label>
                    <span class="tooltip">ÎœÎ­Î³ÎµÎ¸Î¿Ï‚ Î•Ï€Î¯Î´ÏÎ±ÏƒÎ·Ï‚ (Effect Size) ğŸ“ˆ
                        <span class="tooltiptext">Î“Î¹Î± 2 Î¿Î¼Î¬Î´ÎµÏ‚ (T-test) Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ Cohen's d. Î“Î¹Î± 3+ Î¿Î¼Î¬Î´ÎµÏ‚ (ANOVA) Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ Cohen's f.</span>
                    </span>
                    <span id="effectSizeValue" class="value-display">0.50</span>
                </label>
                <input type="range" id="effectSize" min="0.05" max="1.5" step="0.01" value="0.5" oninput="updateValues()">
                <div class="presets">
                    <small>Î ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ (<span id="preset-label">T-test: d</span>):</small>
                    <button id="preset-small" onclick="setEffectSize(0.2)">ÎœÎ¹ÎºÏÎ®</button>
                    <button id="preset-medium" onclick="setEffectSize(0.5)">ÎœÎ­Ï„ÏÎ¹Î±</button>
                    <button id="preset-large" onclick="setEffectSize(0.8)">ÎœÎµÎ³Î¬Î»Î·</button>
                </div>
            </div>
            <div class="control-group">
                <label>
                     <span class="tooltip">Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î™ÏƒÏ‡ÏÏ‚ (Power) ğŸ¯
                        <span class="tooltiptext">Î— Ï€Î¹Î¸Î±Î½ÏŒÏ„Î·Ï„Î± Î½Î± Î±Î½Î¹Ï‡Î½ÎµÏÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·, Î±Î½ Î±Ï…Ï„Î® Ï…Ï€Î¬ÏÏ‡ÎµÎ¹. Î¤Î¹Î¼Î­Ï‚ ÎºÎ¬Ï„Ï‰ Ï„Î¿Ï… 0.80 Î´ÎµÎ½ ÏƒÏ…Î½Î¹ÏƒÏ„ÏÎ½Ï„Î±Î¹.</span>
                    </span>
                    <span id="powerValue" class="value-display">0.80</span>
                </label>
                <input type="range" id="power" min="0.5" max="0.99" step="0.01" value="0.8" oninput="updateValues()">
            </div>
            <div class="control-group">
                <label>
                    <span class="tooltip">Î•Ï€Î¯Ï€ÎµÎ´Î¿ Î£Î·Î¼Î±Î½Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ (alpha) ğŸ²
                        <span class="tooltiptext">Î¤Î¿ ÏÎ¯ÏƒÎºÎ¿ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î¼Î¹Î± ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Ï€Î¿Ï… Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹. Î— ÏƒÏÎ¼Î²Î±ÏƒÎ· ÎµÎ¯Î½Î±Î¹ 5% (0.05).</span>
                    </span>
                    <span id="alphaValue" class="value-display">0.05</span>
                </label>
                <input type="range" id="alpha" min="0.01" max="0.1" step="0.01" value="0.05" oninput="updateValues()">
            </div>
            <h2>Î‘Ï€Î±Î¹Ï„Î¿ÏÎ¼ÎµÎ½Î¿ Î”ÎµÎ¯Î³Î¼Î±:</h2>
            <div id="result">...</div>
        </div>
    </div>

    <script type="text/javascript">
        let pyodide;
        async function main() {
            pyodide = await loadPyodide();
            await pyodide.loadPackage("statsmodels");
            console.log("Pyodide and statsmodels are ready!");
            document.getElementById('loader').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            updateValues(); 
        }
        main();

        function updateValues() {
            const groups = document.getElementById('groups').value;
            updatePresets(groups);
            const effectSizeSlider = document.getElementById('effectSize');
            if (groups > 2) {
                effectSizeSlider.max = 0.8; 
                if (effectSizeSlider.value > 0.8) { effectSizeSlider.value = 0.8; }
            } else {
                effectSizeSlider.max = 1.5;
            }
            const effectSize = effectSizeSlider.value;
            const power = document.getElementById('power').value;
            const alpha = document.getElementById('alpha').value;
            document.getElementById('effectSizeValue').innerText = parseFloat(effectSize).toFixed(2);
            document.getElementById('alphaValue').innerText = parseFloat(alpha).toFixed(2);
            const powerValueDisplay = document.getElementById('powerValue');
            powerValueDisplay.innerText = parseFloat(power).toFixed(2);
            if (power < 0.80) {
                powerValueDisplay.classList.add('warning');
            } else {
                powerValueDisplay.classList.remove('warning');
            }
            calculateSampleSize(effectSize, power, alpha, groups);
        }

        function setEffectSize(value) {
            document.getElementById('effectSize').value = value;
            updateValues();
        }

        function updatePresets(groups) {
            const label = document.getElementById('preset-label');
            const btnSmall = document.getElementById('preset-small');
            const btnMedium = document.getElementById('preset-medium');
            const btnLarge = document.getElementById('preset-large');
            if (groups == 2) {
                label.innerText = "T-test: d";
                btnSmall.onclick = () => setEffectSize(0.2);
                btnMedium.onclick = () => setEffectSize(0.5);
                btnLarge.onclick = () => setEffectSize(0.8);
            } else {
                label.innerText = "ANOVA: f";
                btnSmall.onclick = () => setEffectSize(0.10);
                btnMedium.onclick = () => setEffectSize(0.25);
                btnLarge.onclick = () => setEffectSize(0.40);
            }
        }

        async function calculateSampleSize(effectSize, power, alpha, groups) {
            if (!pyodide) return;
            const resultDiv = document.getElementById("result");
            resultDiv.innerText = "Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÏ„Î±Î¹...";
            resultDiv.classList.remove('error'); 
            let pythonCode = "";
            if (groups == 2) {
                pythonCode = `
from statsmodels.stats.power import TTestIndPower
analysis = TTestIndPower()
sample_size_per_group = analysis.solve_power(effect_size=${effectSize}, power=${power}, alpha=${alpha}, ratio=1.0)
`;
            } else {
                pythonCode = `
from statsmodels.stats.power import FTestAnovaPower
analysis = FTestAnovaPower()
sample_size_per_group = analysis.solve_power(effect_size=${effectSize}, k_groups=${groups}, power=${power}, alpha=${alpha})
`;
            }
            pythonCode += `
import json
if sample_size_per_group is None or sample_size_per_group < 2:
    result = {"error": True}
else:
    result = {"per_group": round(sample_size_per_group), "total": round(sample_size_per_group * ${groups})}
json.dumps(result)
`;
            try {
                let resultsJson = await pyodide.runPythonAsync(pythonCode);
                let results = JSON.parse(resultsJson);
                if (results.error) { throw new Error("Calculation failed in Python."); }
                resultDiv.innerHTML = `<strong>${results.total} Î¬Ï„Î¿Î¼Î± (ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬)</strong><br><small>(${results.per_group} Î¬Ï„Î¿Î¼Î± Î±Î½Î¬ Î¿Î¼Î¬Î´Î±)</small>`;
            } catch (error) {
                console.error("Calculation Error:", error);
                // Î‘Î¥Î¤ÎŸ Î•Î™ÎÎ‘Î™ Î¤ÎŸ Î£Î©Î£Î¤ÎŸ, Î“Î•ÎÎ™ÎšÎŸ ÎœÎ—ÎÎ¥ÎœÎ‘ Î£Î¦Î‘Î›ÎœÎ‘Î¤ÎŸÎ£
                resultDiv.innerText = "Î‘Î´ÏÎ½Î±Ï„Î¿Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚. ÎŸ ÏƒÏ…Î½Î´Ï…Î±ÏƒÎ¼ÏŒÏ‚ Ï„Ï‰Î½ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÏ‰Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎºÏ„ÏŒÏ‚ Î»Î¿Î³Î¹ÎºÏÎ½ Î¿ÏÎ¯Ï‰Î½. Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î½Î± Î±Î»Î»Î¬Î¾ÎµÏ„Îµ ÎµÎ»Î±Ï†ÏÏÏ‚ Î¼Î¯Î± Î±Ï€ÏŒ Ï„Î¹Ï‚ Ï„Î¹Î¼Î­Ï‚.";
                resultDiv.classList.add('error');
            }
        }
    </script>
</body>
</html>
